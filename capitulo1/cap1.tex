\chapter{Introdução} \label{cap:cap1}
\outlineon=1

\outline{
\begin{itemize}
\item WSN são redes de sensores com recursos \dots
\end{itemize}
}


As Redes de Sensores Sem Fio (RSSF) são compostas de pequenos dispositivos equipados com uma antena de comunicação sem fio, um ou mais tipos de sensores, e uma CPU de baixa capacidade de processamento de dados \cite{Baronti:JCC07}. Estes dispositivos geralmente são chamados de \textit{motes}. Devido ao alcance do sinal de rádio limitado e da restrição energética uma RSSF tem limitações e caracteristicas únicas que a difere de redes de computadores e sistemas distribuídos tradicionais \cite{arampatzis2005survey}.

As RSSF tem várias aplicações em diversos campos. A implantação de sensores em aplicações militares foi sempre muito difundido, de modo que a introdução de \textit{motes} era uma incorporação natural para o avanço dos sistemas já utilizados. Aplicações que foram aprimoradas com o uso de RSSF incluem o rastreamento de inimigos e alvos \cite{yang2003}, monitoramento de veículos \cite{sinopoli2003}, sistema contra atirador \cite{simon2004} e sistemas de vigilância \cite{gui2004}. Monitoramento ambiental também provê oportunidades para aplicação de redes sensores sem fio. Nosso meio ambiente tem uma gama muito grande de informações que desempenham um papel importante em nossa qualidade de vida, como a qualidade do ar, água, som e radiação solar que estamos expostos todos os dias e que diretamente afetam nossa saúde \cite{oliveira2011wireless,oliver2004}. Com o interesse cada vez maior em coputação verde nos leva as preocupações com o consumo de energia eletrica em instalações de TI \cite{Chong:IEEEDT14}, e as RSSF têm um papel estratégico no monitoramento e controle destes ambientes \cite{bruno2014}.


Algumas dessas aplicações requerem mecanismos de sincronização de tempo com boa precisão e escalabilidade, tudo isso em conformidade com os seus baixos recursos computacionais e disponibilidade energética \cite{bruno2014,simon2004,yang2003}. Métodos de sincronização tradicionais, como NTP \cite{mills1991}, amplamente utilizado em servidores e clientes de rede não se aplicam em RSSF devido a fatores não determinístas relacionados com o acesso ao meio na transmissão sem fio dos sensores. O Flooding Time Synchronization Protocol (FTSP) é o algoritmo de sincronização de relógio mais popular para RSSF \cite{maroti2004}, ele é tolerante a falhas, consegue alta precisão ($\sim 1,5\mu{s}$ por salto) utilizando \textit{timestamps} em camadas baixas da pilha de rádio, usa a técnica de regressão linear para compensar o escorregamento do relógio usando poucas mensagens pela rede. Contudo, \textit{timestamps} na camada MAC não é um recurso padronizado, e portanto, não interoperáveis entre diferentes hardware e protocolos da camada física. Há um esforço do Google para padronizar \textit{timestamping} na camada MAC em RSSF \cite{Wang:Patent09}, mas até agora não há muita conformidade.

Muitos protocolos de sincronização usam MAC \textit{timestamp}: alguns têm menos precisão do que o FTSP, eles se concentram em outros problemas e fazem suposições mais restritivas \cite{Ganeriwal:Sensys03, vanGreunen:WSNA03}; outros podem conseguir uma melhor precisão entre os nós distantes \cite{Zhang:LNCS07,Lenzen:Sensys09,Sommer:IPSN09}. Elson et ai. propôs o Reference Broadcast Synchronization \cite{Elson:SIGOPS02} (RBS) para eliminar a incerteza do remetente sem MAC \textit{timestamp} removendo o \textit{sender} do caminho crítico. A idéia é que um terceiro irá transmitir um \textit{beacon} para todos os receptores. O \textit{beacon} não contém qualquer informação de tempo; em vez disso os receptores irão comparar seus relógios um ao outro para calcular o escorregamento de seus relógios. Tem $\sim 30\mu{s}$ erro por salto e é independente da MAC \textit{timestamp}. Ranganathan e Nygard oferecem uma boa visão geral desses protocolos \cite{Ranganathan:IJU10}.


\section{Sincronização em Redes Sensores Sem Fio}

\outline{
    Razões e desafios.
    NTP e GPS, Necessidade de algoritmos de sincronização especificos para RSSF.
\begin{itemize}
 \item Intro sobre redes sensores sem fio.
 \item Necessidade da Sincronização em sistemas distribuídos.
 \item Problemas inerentes a sincronização, fontes de atraso e imprecisão em RSSF
\end{itemize}
}

Em sistemas distribuídos como as redes de sensores sem fio, cada nó tem seu próprio relógio e sua própria percepção de tempo. No entanto, uma escala de tempo comum entre nós sensores é importante para identificar relações entre eventos que estejam sendo monitorados, para apoiar a eliminação de dados redundantes de sensores e para facilitar a operação da rede. Uma vez que cada nó em uma rede de sensores opera de forma independente e conta com o seu próprio relógio, as leituras do relógio de diferentes nós de sensores também será divergente. Além destas diferenças aleatórias, a diferença entre os relógios de um conjunto de sensores vai aumentar ainda mais devido às taxas de escorregamento dos seus osciladores. Portanto, a sincronização dos relógios é necessário para assegurar que os tempos de detecção dos eventos que estejam sendo monitorados possam ser comparados e conseguinte significância. 

Embora as técnicas de sincronização de tempo para redes com fios receberam uma quantidade significativa de atenção, esses métodos não são apropriados para uso em RSSF sem modificação, devido aos desafios colocados pelos ambientes sensores sem fio. Estes desafios incluem o tamanho das redes de sensores, a necessidade de auto-configuração e robustez, a mobilidade dos sensores além da necessidade primordial de conservação de energia \cite{Elson2001}.

Nas RSSF a eficiência energética é uma necessidade básica para seu funcionamento, em uma rede de larga escala não é possível fornecer uma fonte de energia para toda a rede, esses sensores geralmente são acoplados a uma bateria. Devido ao tamanho dos dispositivos a quantidade de energia que eles podem produzir ou armazenar é muito limitada \cite{sundararaman2005}.

Sincronização de tempo é um serviço necessário para muitas aplicações e serviços em sistemas distribuídos em geral. Numerosos protocolos de sincronização de tempo têm sido propostos para ambos os sistemas com e sem fio, por exemplo, o Network Time Protocol (NTP) \cite{mills1991} é uma abordagem de sincronização escalável, robusto e auto-configurável amplamente utilizado. Especialmente em combinação com o Sistema de Posicionamento Global (GPS), tem sido utilizado para alcançar a precisão da ordem de alguns microssegundos. No entanto, abordagens como NTP não são adequados para RSSFs devido a ser ineficiente neste contexto pois necessita de maior quantidade de memória. Já o uso de GPS pode elevar o custo de implantação de um sistema de monitoramento, além de requerer vários minutos para sintonizar, GPS também necessita de um uso maior de energia.

%\section{Básico de Sincronização de Tempo}
\subsection{Conceitos Básicos}

\outline{
     Terminologias.
     Efeitos do Ambiente.
     Restrição energética.
     Mobilidade e acesso ao meio sem fio.
     Capacidade dos dispositivos.
}

%A sincronização é normalmente baseada em algum tipo de troca de mensagens entre os nós sensores.

Os relógios dos \textit{motes} nas RSSF são baseados em osciladores de quartzo, o tempo é mensurado nas oscilações do cristal em conjunto a um contador, este contador tem seu valor decrementado até atingir zero, então ele reinicia novamente para seu valor padrão e o processo continua indeterminadamente, toda vez que o contador chega a zero é gerado uma interrupção e essa interrupção é chamada de \textit{tick} ou \textit{clock tick}, ela incrementa outro contador o do relógio a nível de \textit{software} que é de onde vem tempo que utilizamos no sistema operacional. Com isso, esse relógio de \textit{software} fornece para o \textit{mote} um valor de tempo local (\textit{local time}).

Supondo a existência de dois nós, cada um com o seu próprio relógio $R_{a}$ e $R_{b}$, onde $R(t)$ simboliza o valor do relógio no tempo $t$, sendo $t$ o tempo de referência. Se verificarmos $R_{a}(t)$ e $R_{b}(t)$ podemos encontrar uma diferença entre os tempos, essa diferença é chamada de \textit{clock offset}. Para corrigir esta diferença é necessário realizar uma sincronização para que os tempos sejam iguais ou que a diferença seja tão pequena quanto possível. Podemos definir o \textit{clock rate} como a frequência que um relógio progride, assim a frequência do tempo $t$ de um relógio $R_{a}$ é $R^{'}_{a}(t)$, ainda temos o \textit{clock skew} que é a diferença em termo de frequência entre dois relógios \cite{sundararaman2005}. 

\begin{figure}[!h]
 \centering
 \includegraphics{./figuras/figura_drift.png}
 % figura_drift.png: 382x361 pixel, 96dpi, 10.11x9.55 cm, bb=0 0 286 271
 \caption{Comportamento do relógio em relação ao tempo de referência}
 \label{fig:drift}
\end{figure}


Em um mundo perfeito $R_{p}(t) = t$ para qualquer instante de tempo $t$, o relógio perfeito deve ter a variação pelo tempo de referência iguais, como visto na equação \ref{eq:perf_clock}. Vários fatores influenciam o \textit{clock rate}, como por exemplo, temperatura e efeitos do ambiente, energia, limitação do hardware, impureza do crital entre outros. Esta imprecisão do \textit{clock} faz com que a taxa de alteração dos relógios os afaste do valor de referência, $dR/dt > 1$ resulta em um relógio rápido, já $dR/dt < 1$ apresenta um relógio lento, a Figura \ref{fig:drift} demonstra esse efeito. Este comportamento é responsavel pela instabilidade das leituras de tempo nos sensores, fazendo com que seja necessário realizar uma sincronização e mesmo após realizada o desvio irá continuar fazendo efeito sobre o relógio, trazendo a necessidade realização de sincronizações periódicas.


\begin{equation}\label{eq:perf_clock}
 \frac{dR}{dt} = 1
\end{equation}


A sincronização deve ocorrer de forma cíclica, pois os relógios sempre vão afastar-se dos valores de referência, mas o ajuste do tempo local deve ser realizado de forma gradativa e suave, ou seja, deve-se utilizar uma função para mudar o declive do tempo local ao invés de uma atribuição direta. Um problema de efetuar uma mudança corrigindo o valor do tempo diretamente seria o relógio pulando para frente e para trás, ocasionando problemas como por exemplo, uma tarefa agendada poderia nunca ocorrer devido o tempo de sua execução nunca ter existido por causa do salto dos \textit{ticks}, ou ainda o mesmo tempo pode ocorrer duas vezes em virtude de um salto para trás no relógio.

Podemos utilizar duas formas para classificarmos os tipos de sincronização: externo e interno. No método externo os relógios de todos os nós são sincronizados utilizando uma referência de tempo (\textit{clock reference}) externa a rede, geralmente uma fonte de tempo UTC (Coordinated Universal Time), ou seja, o tempo do mundo real baseado em um relógio atômico. Por outro lado, na sincronização interna todos os nós são sincronizados sem a ajuda de uma referencia de tempo externa, o objetivo é minimizar a diferença entre os relógios locais dos sensores tendo assim uma noção consistente do tempo entre todos os nós da rede \cite{kopetz2011real}.

Um conjunto de fatores podem influênciar o funcionamento de sistemas de sensores sem fio alterando seu desempenho, os principais componentes que devem ser observados são listados abaixo:

\textbf{Efeitos Ambientais:} Pressão, temperatura, humidade são algumas das condições de ambiente que alteram o funcionamento normal dos osciladores. Muitas RSSF são criadas para implantação \textit{outdoor}, nestes cenários as condições são bem diferentes das apresentadas em um ambiente estável como um laboratório \cite{karl2007protocols}. Fenômenos climáticos como chuva, neblina e vento também tem influência na performance de sistemas de RSSF, podendo até mesmo impossibilitar seu funcionamento \cite{otero2001high}.
%\cite{mills1998}

\textbf{Limitações Energéticas:} Economizar energia é o maior interesse em RSSF, o tamanho pequeno dos nós sensores limita o tamanho de sua bateria, bem como a quantidade de energia que ele pode produzir usando placa solar \cite{elson2003romer}. A transmissão de mensagens é a base dos algoritmos de sincronização, a energia utilizada para a transmissão de 1Kb a uma distância de 100 metros é aproximadamente de 3 joules, o mesmo necessário para o processador executar 3 milhões de instruções \cite{pottie2000}. Transmitir é mais custoso energeticamente do que computar, assim os algoritmos de sincrozação devem minimizar a necessidade de troca de mensagens para serem mais eficientes energeticamente.


\textbf{Wireless e Mobilidade:} A comunicação sem fio apresenta grandes desafios nas redes de sensores, como vimos, é gasto mais energia transmitindo dados do que processando, fenômenos climáticos como chuva, neblina degradam a performance da rede. A característica de transmissão de dados por difusão nas RSSF requer a utilização de um protocolo MAC (Media Access Control) para ordenar o acesso ao meio, dependendo da densidade da rede, faixa de alcance dos nós (entre 20-100 metros) e o tráfego dos dispositivos podem incorrer em interferências na comunicação que levam a perdas de mensagens e conexão intermitente. Grande quantidade de redes sensores são móveis, os nós podem se mover, podem ocorrer falhas na comunicação, a bateria pode esgotar e o nó ficar inativo, causando constantes mudanças na topologia das redes. Por consequência destes problemas, os protocolos de sincronização devem ser projetados para respeitar todas essas propriedades.

\begin{figure}[h]
 \centering
 \includegraphics{./figuras/esquema_sensor.png}
 % esquema_sensor.png: 662x178 pixel, 96dpi, 17.51x4.71 cm, bb=0 0 496 133
 \caption{Componentes de um mote para RSSF \cite{hill2004platforms} }
 \label{fig:esquema_sensor}
\end{figure}

\textbf{Limitação de \textit{Hardware}:} O tamanho e o preço dos sensores são algumas das razões pelas quais seu \textit{hardware} ser bastante limitado, aumentar o tamanho poderia elevar seu custo e consumo de energia, podendo tornar inviável as aplicações de redes sensores em larga escala \cite{kahn1999}. A capacidade computacional destes dispositivos é similar aos computadores pessoais do início da década de 80, a Figura \ref{fig:esquema_sensor} ilustra os componentes típicos de um nó sensor, transmissor fraco sujeito a perdas, memória limitada, processador de baixa capacidade aliado a fonte de energia restrita. Os algoritmos para RSSF devem respeitar esse conjunto de desafios e limitações com o objetivo de minimizar o uso dos recursos e manter seus resultados funcionais.


\begin{figure}[h]
 \centering
 \includegraphics{./figuras/overhead.png}
 % overhead.png: 125x155 pixel, 96dpi, 3.31x4.10 cm, bb=0 0 94 116
 \caption{Tradeoff custo-beneficio \cite{holtkamp2013}}
 \label{fig:overhead}
\end{figure}


Os novos avanços nos sistemas integrados nos permitiram desenvolver dispositivos sensores com baixos recursos de energia, rádio e processamento. Visto que uma rede de sensores consista de um bom número de sensores, o valor de um só nó afeta a implantação da rede toda. Alguns preveem que com a grande quantidade de sensores aplicados hoje em dia, seu valor possa chegar a ser menos de \$1 dolar \cite{cuevas2007, wang2007topology}. 

Os \textit{motes} são fabricados com materiais de baixo custo e as vezes de menor qualidade, como por exemplo, um cristal de quartzo de baixa qualidade pode ser um dos fatores que tornam o relógios mais imprecisos. A Figura \ref{fig:overhead} apresenta o \textit{tradeoff} entre o  preço e a qualidade, o preço de produção do dispositivo determina a precisão do seu relógio, assim quanto menos preciso o relógio é mais compensação será necessária para corrigir seu tempo, a compensação gera maior \textit{overhead} de comunicação que é gasto no uso de comunicação/energia.



\subsection{Fontes de Imprecisão em Comunicação}

\outline{
    Send delay:
    Access delay:
    Propagation delay:
    Receive delay:
}


A troca de mensagens de comunicação é a principal ferramenta dos protocolos de sincronização, o não determinismo causado pelas latências no processo de troca de mensagens interfere na precisão que pode ser alcançado pelo protocolo. A latência pode ser decomposta em variados componentes, descritos por \cite{kopetz2011real} e \cite{sundararaman2005} e listados a seguir:

\begin{itemize}
 
 \item Tempo no envio: É o tempo que o sistema leva para montar a mensagem e passar a requisição de transmissão para a camada de acesso ao meio. Fonte de atraso causado principalmente pelo sistema operacional e da carga de uso do CPU.
 
 \item Tempo de acesso ao meio: Ocorre devido a janela de contenção do acesso ao meio, é o tempo que o nó leva para ter acesso físico para transmissão esperando o canal estar desocupado para então para usá-lo. Redes sem fio compartilham o mesmo meio de comunicação necessitando de uma forma de coordenar quem pode usar o canal e assim evitar colisões. O protocolo MAC do 802.11 serve como base para as variações utilizadas em RSSF, estes buscam atingir maior eficiência no consumo de energia, algumas opções destes protocolos são: BMAC (\textit{Versatile low power media access}) \cite{bmac}, S-MAC  (\textit{Sensor-MAC}) \cite{smac}, Box-MAC \cite{boxmac}, PAMAS (\textit{Power-Aware Multi-Access Protocol}) \cite{pamas} e ainda os \textit{surveys} \cite{suriyachai2012survey, huang2013evolution} tem referências mais atualisadas.
 
 \item Tempo de transmissão: Tempo que leva para um nó transmitir uma mensagem para outro nó, varia dependendo do tamanho do pacote e da velocidade da banda.
 
 \item Tempo de propagação: Tempo que a mensagem leva para chegar no receptor desde o momento que deixou o emissor. Este tempo é muito pequeno e geralmente insignificante para a análise geral do atraso.
 
 \item Tempo no recebimento: É o mesmo tempo da transmissão

\end{itemize}
 


...figure...

% \begin{enumerate}
%   \setcounter{enumi}{5}
%   \item fifth element
% \end{enumerate}

\subsection{Mensagens de Sincronização}
\outline{
    \textit{Pairwise synchronization, One-Way Message Exchange, Two-Way Message Exchange, Receiver-Receiver Synchronization}
}


\section{Definição do Problema}

\outline{Dependência de hardware, padronização do recurso, esforço para que exista futuramente um padrão que esteja presente em todos os tipos de \textit{motes} e possibilite assim a interoperação de protocolos de MAC \textit{timestamp} em sistemas heterogênios.}

\section{Motivação do Trabalho}

\outline{
\begin{itemize}
   \item Devido a diversidade de dispositivos e o bom desempenho do FTSP, tona-lo um protocolo independente de recurso de hardware possibilitando o seu funcionamento em \textit{motes} sem o recurso de MAC timestamp.
\end{itemize}
}


\section{Contribuição da Dissertação}\label{sec:contrib}
\outline{
\begin{itemize}
 \item Fazer o FTSP funcionar com timestamp a nível de aplicação.
\end{itemize}
}
 

\section{Organização do Documento}\label{sec:org}


Esta dissertação é composta por seis capítulos. Descrever no final o que cada capítulo apresenta.

\begin{itemize}
 \item \textbf{Capítulo 2:} Descrever conteúdo aqui.
 \item \textbf{Capítulo 3:} Descrever conteúdo aqui.
 \item \textbf{Capítulo 4:} Descrever conteúdo aqui.
 \item \textbf{Capítulo 5:} Descrever conteúdo aqui.
 \item \textbf{Capítulo 6:} Descrever conteúdo aqui.
 \item \textbf{Capítulo 7:} Descrever conteúdo aqui.
\end{itemize}
